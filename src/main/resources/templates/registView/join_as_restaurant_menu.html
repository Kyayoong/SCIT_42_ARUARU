<!DOCTYPE html>
<html xmlns:th="http://thymeleaf.org">
<head>
<meta charset="UTF-8">
<script th:src="@{/js/jquery-3.6.0.min.js}"></script>
<link th:href="@{/css/registCss.css}" rel="stylesheet">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
<script
	src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js">
	
</script>
<script
	src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js">
</script>
<script>
	$(document).ready(function()
	// input file 파일 첨부시 fileCheck 함수 실행
	{
		$("#input_file").on("change", fileCheck);
	});

	/**
	 * 첨부파일로직
	 */
	 $(function() {
			$('#btn-upload').click(function(e) {
				e.preventDefault();
				$('#btnAtt').click();
			});
		});
	
	 $(function() {
			$('#btn-upload2').click(function(e) {
				e.preventDefault();
				$('#btnAtt2').click();
			});
		});
	
	//ID 중복 확인창 열기
	 function menuFormOpen() {
		var option = "top=100,left=575,width=400,height=500,location= no,scrollbars = yes,toolbars= no,status= no"
	 	var w = window.open('join_as_restaurant_menu_add', 'addwin', option);
	 }
	
	//보내는데 데이터 체크
	function check() {
		let restaurant_name = document.getElementById('restaurant_name');
		let restaurant_ename = document.getElementById('restaurant_ename');
		let restaurant_sectors = document.getElementById('restaurant_sectors');
		let restaurant_comment = document.getElementById('restaurant_comment');
		let tag = document.getElementById('restaurant_name');
		let restaurant_phone = document.getElementById('restaurant_phone');
		let restaurant_phone1 = document.getElementById('restaurant_phone1');
		let restaurant_phone2 = document.getElementById('restaurant_phone2');
		let restaurant_address = document.getElementById('restaurant_address');
		let restaurant_address1 = document
				.getElementById('restaurant_address1');
		let restaurant_address2 = document
				.getElementById('restaurant_address2');

		restaurant_phone.value = restaurant_phone1.value + "-"
				+ restaurant_phone2.value;
		restaurant_address.value = restaurant_address1.value + " "
				+ restaurant_address2.value;

		console.log(restaurant_phone.value);
		console.log(restaurant_address.value);
		console.log(restaurant_phone1.value);
		console.log(restaurant_phone2.value);
		console.log(restaurant_address1.value);
		console.log(restaurant_address2.value);

		if (restaurant_name.value.length < 1) {
			alert("식당 이름을 입력하세요.");
			restaurant_name.focus();
			restaurant_name.select();
			return false;
		}

		if (restaurant_ename.value.length < 1) {
			alert("식당 이름(영어)을 입력하세요.");
			restaurant_ename.focus();
			restaurant_ename.select();
			return false;
		}

		if (restaurant_comment.value.length < 1) {
			alert("내용을 입력하세요.");
			restaurant_comment.focus();
			restaurant_comment.select();
			return false;
		}

		if (restaurant_phone2.value.length < 8) {
			alert("식당 번호를 입력하세요.");
			restaurant_phone2.focus();
			restaurant_phone2.select();
			return false;
		}

		if (restaurant_address1.value.length < 1) {
			alert("식당 주소를 입력하세요.");
			restaurant_address1.focus();
			restaurant_address1.select();
			return false;
		}

		if (restaurant_address2.value.length < 1) {
			alert("식당 상세주소를 입력하세요.");
			restaurant_address2.focus();
			restaurant_address2.select();
			return false;
		}
		return true;
	}
</script>
<title>[ 식당 등록 ]</title>
</head>
<body>
	<!-- 네이게이션 바 -->
	<nav id="navbar" class="navbar navbar-expand-sm bg-light">
		<ul class="navbar-nav">
			<li class="nav-item"><a class="nav-link" th:href="@{/}">HOME</a>
		</ul>
		<ul class="navbar-nav ml-auto">
			<li class="nav-item"><a class="nav-link" href="#">ABOUT US</a></li>
			<li class="nav-item"><a class="nav-link"
				th:href="@{/user/login}">LOGIN</a></li>
			<li class="nav-item"><a class="nav-link"
				th:href="@{/user/joinselect}">JOIN</a></li>
		</ul>
	</nav>

	<!-- 식당 등록 폼 -->
	<div id="registform">
		<div id="rrmarkarea">
			<img id="rrmark" th:src="@{../images/rrmark.png}"> <img
				id="rrjapanesemark" th:src="@{../images/rrjapanesemark.png}">
			<div id="inform-restaurant-register">
				<p style="font-family: IBM Plex Sans KR;">메뉴 등록 화면입니다.</p>
			</div>
		</div>
		<!-- 식당 등록 테이블 -->
		<div id="registtable">
			<p style="font-family: IBM Plex Sans KR;">음식점 업종은 메뉴판 사진과1개 이상의
				메뉴 등록이 필요합니다. 언제든지 추가 수정이 가능합니다</p>
			<form th:action="@{/restaurant/regist1}"
				enctype="multipart/form-data" method="post"
				onsubmit="return check();">
				<table>
					<tr>
						<td><label for="menu_priceavr"
							style="font-family: IBM Plex Sans KR;">1인당 평균 가격은 얼마정도
								인가요?</label><br> <select class="form-control" id="menu_priceavr"
							name="menu_priceavr">
								<option value="1">1만원 미만</option>
								<option value="2">1~1.5만원</option>
								<option value="3">1.5만원</option>
								<option value="4">1.5~2만원</option>
								<option value="5">2~3만원</option>
								<option value="6">3~5만원</option>
								<option value="7">5만원 이상</option>
						</select></td>
					</tr>
					<tr>
						<td><label for="fffle" style="font-family: IBM Plex Sans KR;">메뉴판
								사진</label><br>
							<div id='image_preview'>
								<button class="btn btn-primary" id="btn-upload" type="button">
									파일추가</button>
								<input id="btnAtt" multiple="multiple" type="file"
									accept="image/*" name="upload" style="display: none;">
								<span style="font-family: IBM Plex Sans KR;">※첨부파일은 최대
									5개까지 등록이 가능합니다.(필수)</span>
								<div id='att_zone'
									data-placeholder='파일을 첨부 하려면 파일 선택 버튼을 클릭하거나 파일을 드래그앤드롭 하세요'></div>
							</div> <script type="text/javascript">

							( /* att_zone : 이미지들이 들어갈 위치 id, btn : file tag id */
							imageView = function imageView(att_zone, btn){

							var attZone = document.getElementById(att_zone);
							var btnAtt = document.getElementById(btn)
							var sel_files = [];
									    
									    // 이미지와 체크 박스를 감싸고 있는 div 속성
									    var div_style = 'display:inline-block;position:relative;'
									                  + 'width:150px;height:120px;margin:5px;border:1px solid #00f;z-index:1';
									    // 미리보기 이미지 속성
									    var img_style = 'width:100%;height:100%;z-index:none';
									    // 이미지안에 표시되는 체크박스의 속성
									    var chk_style = 'width:30px;height:30px;position:absolute;font-size:24px;'
									                  + 'right:0px;bottom:0px;z-index:999;background-color:rgba(255,255,255,0.1);color:#f00';
									  
									    btnAtt.onchange = function(e){
									      var files = e.target.files;
									      var fileArr = Array.prototype.slice.call(files)
									      for(f of fileArr){
									        imageLoader(f);
									      }
									    }  
									    
									  
									    // 탐색기에서 드래그앤 드롭 사용
									    attZone.addEventListener('dragenter', function(e){
									      e.preventDefault();
									      e.stopPropagation();
									    }, false)
									    
									    attZone.addEventListener('dragover', function(e){
									      e.preventDefault();
									      e.stopPropagation();
									      
									    }, false)
									  
									    attZone.addEventListener('drop', function(e){
									      var files = {};
									      e.preventDefault();
									      e.stopPropagation();
									      var dt = e.dataTransfer;
									      files = dt.files;
									      for(f of files){
									        imageLoader(f);
									      }
									      
									    }, false)
									    

									    
									    /*첨부된 이미리즐을 배열에 넣고 미리보기 */
									    imageLoader = function(file){
									      sel_files.push(file);
									      var reader = new FileReader();
									      reader.onload = function(ee){
									        let img = document.createElement('img')
									        img.setAttribute('style', img_style)
									        img.src = ee.target.result;
									        attZone.appendChild(makeDiv(img, file));
									      }
									      
									      reader.readAsDataURL(file);
									    }
									    
									    /*첨부된 파일이 있는 경우 checkbox와 함께 attZone에 추가할 div를 만들어 반환 */
									    makeDiv = function(img, file){
									      var div = document.createElement('div')
									      div.setAttribute('style', div_style)
									      
									      var btn = document.createElement('input')
									      btn.setAttribute('type', 'button')
									      btn.setAttribute('value', 'x')
									      btn.setAttribute('delFile', file.name);
									      btn.setAttribute('style', chk_style);
									      btn.onclick = function(ev){
									        var ele = ev.srcElement;
									        var delFile = ele.getAttribute('delFile');
									        for(var i=0 ;i<sel_files.length; i++){
									          if(delFile== sel_files[i].name){
									            sel_files.splice(i, 1);      
									          }
									        }
									        
									        dt = new DataTransfer();
									        for(f in sel_files) {
									          var file = sel_files[f];
									          dt.items.add(file);
									        }
									        btnAtt.files = dt.files;
									        var p = ele.parentNode;
									        attZone.removeChild(p)
									      }
									      div.appendChild(img)
									      div.appendChild(btn)
									      return div
									    }
									  }
									)('att_zone', 'btnAtt')

							</script>
							</td>
						</tr>			
						<tr>
						<td><label for="fffle" style="font-family: IBM Plex Sans KR;">메뉴를 추가해주세요.</label>
						<span style="font-family: IBM Plex Sans KR;">※(필수)</span>
						<br>
							<div id='image_preview'>
								<button class="btn btn-primary" id="btn-upload2" type="button" style="width: 600px" onclick="menuFormOpen()">
									메뉴추가</button>
								<input id="btnAtt2" type="button" style="display: none;">
								<div id='att_zone'
									data-placeholder='파일을 첨부 하려면 파일 선택 버튼을 클릭하거나 파일을 드래그앤드롭 하세요'></div>
							</div>
							</td>
						</tr>		
						<tr>
						<td>
							<p></p>
						</td>
					</tr>
				</table>
				<!-- 전송 보낼거임~-->
				<div id="registerbuttondiv">
					<input type="button" style="font-family: IBM Plex Sans KR;"
						class="btn btn-primary" value="취소">
					<input type="submit" style="font-family: IBM Plex Sans KR;"
						class="btn btn-primary" value="다음">
				</div>
				<br>
			</form>

		</div>
	</div>
	<!-- 공백용 -->
	<div id="empty">
		<p></p>
	</div>
</body>
</html>