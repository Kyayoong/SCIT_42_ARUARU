<!DOCTYPE html>
<html xmlns:th="http://thymeleaf.org">
<head>
<meta charset="UTF-8">
<link th:href="@{/css/registCss2.css}" rel="stylesheet">
<script th:src="@{/js/jquery-3.6.0.min.js}"></script>
<style type="text/css">
</style>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
<script
	src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js">
	
</script>
<script
	src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js">
</script>
<script type="text/javascript">

		/**
		 * 첨부파일로직
		 */
		 $(function() {
				$('#btn-upload').click(function(e) {
					e.preventDefault();
					$('#btnAtt').click();
				});
			});
</script>
<title>[ 메뉴 등록하기 ]</title>
</head>
<body>
	<div id="registtable">
		<h3 id="h3" style="font-family: IBM Plex Sans KR;">메뉴 추가하기</h3>
		<br> <br>
		<form th:action="@{/restaurant/regist1}" enctype="multipart/form-data"
			method="post" onsubmit="return check();">
			<table>
				<tr>
					<td><label for="menu_name"
						style="font-family: IBM Plex Sans KR;">메뉴명 </label><br> <input
						class="form-control" type="text" id="menu_name" name="menu_name"
						style="width: 350px;" placeholder="메뉴명을 입력하세요.(필수)"></td>
				</tr>
				<tr>
					<td><label for="menu_price"
						style="font-family: IBM Plex Sans KR;">메뉴가격 </label><br> <input
						class="form-control" type="text" id="menu_price" name="menu_price"
						style="width: 350px;" placeholder="메뉴가격을 입력하세요.(필수) - 원"></td>
				</tr>
				<tr>
					<td class="contents"><label for="menu_content"
						style="font-family: IBM Plex Sans KR;">상세 설명</label> <br> <textarea
							placeholder="메뉴에 대해서 설명해주세요." class="form-control" rows="3"
							cols="27.5" name="menu_content" id="menu_content"></textarea></td>
				</tr>
				<tr>
				<tr>
					<td><label for="fffle" style="font-family: IBM Plex Sans KR;">메뉴
							사진</label> <span style="font-family: IBM Plex Sans KR;">※(필수)</span> <br>
						<div id='image_preview'>
							<button class="btn btn-primary" id="btn-upload" type="button">
								사진 추가</button>
							<input id="btnAtt" multiple="multiple" type="file"
								accept="image/*" name="upload" style="display: none;"> <span
								style="font-family: IBM Plex Sans KR;">※첨부파일은 1개만</span>
							<div id='att_zone'></div>
						</div>
						<script type="text/javascript">

							( /* att_zone : 이미지들이 들어갈 위치 id, btn : file tag id */
							imageView = function imageView(att_zone, btn){

							var attZone = document.getElementById(att_zone);
							var btnAtt = document.getElementById(btn)
							var sel_files = [];
									    
									    // 이미지와 체크 박스를 감싸고 있는 div 속성
									    var div_style = 'display:inline-block;position:relative;'
									                  + 'width:150px;height:120px;margin:5px;border:1px solid #00f;z-index:1';
									    // 미리보기 이미지 속성
									    var img_style = 'width:100%;height:100%;z-index:none';
									    // 이미지안에 표시되는 체크박스의 속성
									    var chk_style = 'width:30px;height:30px;position:absolute;font-size:24px;'
									                  + 'right:0px;bottom:0px;z-index:999;background-color:rgba(255,255,255,0.1);color:#f00';
									  
									    btnAtt.onchange = function(e){
									      var files = e.target.files;
									      var fileArr = Array.prototype.slice.call(files)
									      for(f of fileArr){
									        imageLoader(f);
									      }
									    }  
									    									    
									    /*첨부된 이미리즐을 배열에 넣고 미리보기 */
									    imageLoader = function(file){
									      sel_files.push(file);
									      var reader = new FileReader();
									      reader.onload = function(ee){
									        let img = document.createElement('img')
									        img.setAttribute('style', img_style)
									        img.src = ee.target.result;
									        attZone.appendChild(makeDiv(img, file));
									      }
									      
									      reader.readAsDataURL(file);
									    }
									    
									    /*첨부된 파일이 있는 경우 checkbox와 함께 attZone에 추가할 div를 만들어 반환 */
									    makeDiv = function(img, file){
									      var div = document.createElement('div')
									      div.setAttribute('style', div_style)
									      
									      var btn = document.createElement('input')
									      btn.setAttribute('type', 'button')
									      btn.setAttribute('value', 'x')
									      btn.setAttribute('delFile', file.name);
									      btn.setAttribute('style', chk_style);
									      btn.onclick = function(ev){
									        var ele = ev.srcElement;
									        var delFile = ele.getAttribute('delFile');
									        for(var i=0 ;i<sel_files.length; i++){
									          if(delFile== sel_files[i].name){
									            sel_files.splice(i, 1);      
									          }
									        }
									        
									        dt = new DataTransfer();
									        for(f in sel_files) {
									          var file = sel_files[f];
									          dt.items.add(file);
									        }
									        btnAtt.files = dt.files;
									        var p = ele.parentNode;
									        attZone.removeChild(p)
									      }
									      div.appendChild(img)
									      div.appendChild(btn)
									      return div
									    }
									  }
									)('att_zone', 'btnAtt')

							</script>
						
						</td>
				</tr>
			</table>
			<br>
			<div id="registerbuttondiv">
				<input type="button" style="font-family: IBM Plex Sans KR;"
					class="btn btn-primary" value="취소"> <input type="submit"
					style="font-family: IBM Plex Sans KR;" class="btn btn-primary"
					value="등록">
			</div>
			<br>
		</form>
	</div>
</body>
</html>