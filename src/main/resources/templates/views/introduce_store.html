<!DOCTYPE html>
<html lang="ko" xmlns:th="http://thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
<style>
</style>
<link rel="stylesheet" th:href="@{/css/introduce_storeCss.css}">
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
<!-- jQuery -->
<script th:src="@{/js/jquery-3.6.0.min.js}"></script>

<script
	src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.slim.min.js"></script>
<script
	src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
<script
	src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>

<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script>
$(function() {
	$('#btn1').click(function(e) {
		console.log("x");
		e.preventDefault();
		$('#btn-modal').click();
	});
});

$(function() {
	$('#btn2').click(function(e) {
		console.log("x");
		e.preventDefault();
		$('#btnAtt').click();
	});
});
</script>
<title>Document</title>
</head>
<body>

	<!-- navbar 부분-->
	<nav id="navbar" class="navbar navbar-expand-sm bg-light">
		<ul class="navbar-nav">
			<!-- 로그인 계정이 일반계정인지 관리자인지 나타내줍니다.(임시) -->
			<li th:if="${member.member_nickname != null}"
				sec:authorize="hasRole('USER')" class="nav-item"
				th:text="|${member.member_nickname}님이 로그인하셨습니다.|">[일반 사용자] 입니다.</li>
			<li sec:authorize="hasRole('ADMIN')" class="nav-item">[관리자] 입니다.</li>
		</ul>
		<ul class="navbar-nav ml-auto">
			<!-- 관리자 페이지로 넘어가는 버튼입니다. 임시로 추가해두었고, 나중에는 로그인하면, 자동으로 이쪽으로 넘어가게 할 예정입니다. -->
			<li class="nav-item"><a class="nav-link"
				th:href="@{/admin/main}">Admin(임시)</a></li>
			<li class="nav-item"><a class="nav-link" href="#">ABOUT US</a></li>
			<li class="nav-item"><a class="nav-link"
				th:href="@{/user/login}">LOGIN</a></li>
			<li class="nav-item"><a class="nav-link"
				th:href="@{/join_as_user}">JOIN</a></li>
		</ul>
	</nav>
	<div id="container1">

		<!--알파벳 CI-->
		<a th:href="@{/}"><img id="RR" th:src="@{/images/rrmark.png}"></a>
		<!--일본어 CI-->
		<a th:href="@{/}"><img id="aruaru" th:src="@{/images/rrjapanesemark.png}"></a>
		<!--검색 부분-->

		<table style="font-family: Jua;">
			<tr>
				<td><input type="text" class="form-control" id="area-input"
					placeholder="지역"></td>
				<td><input type="text" class="form-control" id="keyword-input"
					placeholder="키워드(ex)오마카세, 분위기있는)"></td>
				<td><input type="date" class="form-control" id="day-input"></td>
				<td><select id="select-time" class="form-control">
						<option value="0900">09:00</option>
						<option value="0930">09:30</option>
						<option value="1000">10:00</option>
						<option value="1030">10:30</option>
						<option value="1100">11:00</option>
						<option value="1130">11:30</option>
						<option value="1200">12:00</option>
						<option value="1230">12:30</option>
						<option value="1300">13:00</option>
						<option value="1330">13:30</option>
						<option value="1400">14:00</option>
						<option value="1430">14:30</option>
						<option value="1500">15:00</option>
						<option value="1530">15:30</option>
						<option value="1600">16:00</option>
						<option value="1630">16:30</option>
						<option value="1700">17:00</option>
						<option value="1730">17:30</option>
						<option value="1800">18:00</option>
						<option value="1830">18:30</option>
						<option value="1900">19:00</option>
						<option value="1930">19:30</option>
						<option value="2000">20:00</option>
						<option value="2030">20:30</option>
						<option value="2100">21:00</option>
						<option value="2130">21:30</option>
						<option value="2200">22:00</option>
				</select></td>
				<td><input type="text" class="form-control" id="person-input"
					placeholder="인원수"></td>
				<td><input type="submit" class="btn btn-primary"
					id="search-submit" value="검색"></td>
			</tr>
		</table>
	</div>
	<!-- 회전화면 부분 -->
	<div id="demo" class="carousel slide carousel-fade"
		data-ride="carousel">

		<!-- 인디케이터 -->
		<ul class="carousel-indicators">
			<li data-target="#demo" data-slide-to="0" class="active"></li>
			<li data-target="#demo" data-slide-to="1" class="active"></li>
			<li data-target="#demo" data-slide-to="2" class="active"></li>
		</ul>

		<!-- 안쪽 그림 부분 -->
		<div id="carousel-inner" class="carousel-inner">
			<div class="carousel-item active">
				<img
					th:src="|filedis?restaurant_file_num=${fileList.get(0).getRestaurant_file_num}|"
					alt="pasta"
					style="width: 1200px; height: 500px; padding-left: 8.5vw; top: 5.5vh;">
			</div>

			<div class="carousel-item "
				th:if="${fileList.get(1).getRestaurant_file_num} != null">
				<img
					th:src="|filedis?restaurant_file_num=${fileList.get(1).getRestaurant_file_num}|"
					alt="pizza"
					style="width: 1200px; height: 500px; padding-left: 8.5vw; top: 5.5vh;">
			</div>
			<div class="carousel-item" th:if="${fileList.size()} > 2">
				<img
					th:src="|filedis?restaurant_file_num=${fileList.get(2).getRestaurant_file_num}|"
					alt="restaurant"
					style="width: 1200px; height: 500px; padding-left: 8.5vw; top: 5.5vh;">
			</div>
		</div>
	</div>

	<!-- 소개 부분 시작 -->
	<div id="introduce-area">
		<!-- 위치 깃발 그림 부분 -->
		<img id="flag-icon" th:src="@{/images/map_flag_icon.png}">
		<!-- 위치 글씨 부분 -->
		<div id="location-area">
			<h3 th:text="${store.restaurant_address1}"></h3>
		</div>
		<!-- 음식점 이름 -->
		<div id="store-name">
			<h1 th:text="${store.restaurant_name}"></h1>
		</div>
		<!-- 맛집 소개글 -->
		<div id="store-contents">
			<p th:text="${store.restaurant_comment}">
		</div>
		<!-- 메뉴 표시 -->
		<div id="menu-area">
			<table class="table table-hover">
				<tr>
					<th>메뉴</th>
					<th>가격</th>
					<th>특징</th>
				</tr>
				<tr th:each="menu : ${menuList}">
					<td th:text="${menu.menu_name}"></td>
					<td th:text="|${menu.menu_price}원|"></td>
					<td><img th:src="|menudis?menu_num=${menu.menu_num}|"
						style="width: 60px; height: 60px;"></td>
				</tr>
			</table>
		</div>
		<!-- 가게 정보 -->
		<div id="store-information">
			<h3>영업 시간</h3>
			<table class="table table-hover">
				<tr>
					<th>영업일</th>
					<th>오픈시간</th>
					<th>닫는시간</th>
				</tr>
				<tr th:each="time : ${timeTable}">
					<td th:text="${time.business_days}"></td>
					<td th:text="${time.opentime}"></td>
					<td th:text="${time.closetime}"></td>
				</tr>
			</table>
		</div>
		<!-- 가게 관련 태그 -->
		<div id="store-tags">
			<h3>스토어 태그</h3>
			<table id="tableTags">
				<tr>
					<td th:each="tag : ${storeTagList}">
						<div id="idtag1" class="btn-group-toggle" data-toggle="buttons">
							<label class="btn btn-outline-secondary" th:for="${tag.tags_num}"
								style="width: max-content; height: 35px; display: inline-block;">
								<input name="tags_name" th:value="${tag.tags_name}"
								type="checkbox" th:id="${tag.tags_num}" th:num="${tag.tags_num}"
								class="tag1">[[${tag.tags_name}]]
							</label>
						</div>
					</td>
				</tr>
			</table>
		</div>
		<!-- 리뷰부분 -->
		<div id="store-commentary">
			<h3 th:text="|평점 : ${store.restaurant_grade}|"></h3>
			<table class="table">
				<tr>
					<td>
						<div class="row">
							<div class="col">
								<div id="profile-img">
									<img th:src="@{/images/pose_ukkari_woman.png}"
										class="rounded-circle" alt="프로필사진"
										style="width: 7vw; height: 7vw;">
								</div>
								<div class="profile-nickname">
									<h4>닉네임</h4>
								</div>
								<div class="reviews-followers">
									<h6>리뷰0 팔로워0</h6>
								</div>
								<div class="score-star">
									<img th:src="@{/images/star_icon.png}"
										style="width: 1.5vw; height: 1.5vw;">
								</div>
								<div class="score-number">
									<h5>3.5</h5>
									<div class="comment">
										<h5>그럭저럭 갈만해요</h5>
									</div>
								</div>
								<div class="upload-date">
									<h6>작성일 : 2022.09.07 / 방문일 : 2022.08.27</h6>
								</div>
							</div>
							<div class="col">
								<div class="profile-img">
									<img th:src="@{/images/pose_ukkari_woman.png}"
										class="rounded-circle" alt="프로필사진"
										style="width: 7vw; height: 7vw;">
								</div>
								<div class="profile-nickname">
									<h4>닉네임</h4>
								</div>
								<div class="reviews-followers">
									<h6>리뷰0 팔로워0</h6>
								</div>
								<div class="score-star">
									<img th:src="@{/images/star_icon.png}"
										style="width: 1.5vw; height: 1.5vw;">
								</div>
								<div class="score-number">
									<h5>3.5</h5>
									<div class="comment">
										<h5>그럭저럭 갈만해요</h5>
									</div>
								</div>
								<div class="upload-date">
									<h6>작성일 : 2022.09.07 / 방문일 : 2022.08.27</h6>
								</div>
							</div>
						</div>
					</td>
				</tr>
			</table>
		</div>

		<!-- 밑 부분 bar -->
		<div id="bottom-bar">
			<form action="">
				<table id="input-book-bottom">
					<tr>
						<td><input style="width: 10vw;" type="date"
							class="form-control" id="day-input-bottom"></td>
						<td><select id="select-time-bottom" class="form-control">
								<option value="0900">09:00</option>
								<option value="0930">09:30</option>
								<option value="1000">10:00</option>
								<option value="1030">10:30</option>
								<option value="1100">11:00</option>
								<option value="1130">11:30</option>
								<option value="1200">12:00</option>
								<option value="1230">12:30</option>
								<option value="1300">13:00</option>
								<option value="1330">13:30</option>
								<option value="1400">14:00</option>
								<option value="1430">14:30</option>
								<option value="1500">15:00</option>
								<option value="1530">15:30</option>
								<option value="1600">16:00</option>
								<option value="1630">16:30</option>
								<option value="1700">17:00</option>
								<option value="1730">17:30</option>
								<option value="1800">18:00</option>
								<option value="1830">18:30</option>
								<option value="1900">19:00</option>
								<option value="1930">19:30</option>
								<option value="2000">20:00</option>
								<option value="2030">20:30</option>
								<option value="2100">21:00</option>
								<option value="2130">21:30</option>
								<option value="2200">22:00</option>
						</select></td>
						<td><input type="text" class="form-control"
							id="person-input-bottom" style="width: 5vw;" placeholder="인원수"></td>
						<td><button class="btn btn-primary" id="btn1" type="button"
									style="width: 150px">예약하기</button> <input id="btn-modal"
								type="button" style="display: none;"></td>
						<td><input type="hidden" value="시퀀스넘버"></td>
					</tr>
				</table>
			</form>
			<!-- 모달창 내부입니다. -->
			<div id="modal" class="modal-overlay">
				<div class="modal-window">
					<div class="content">
						<div id="registtable2">
							<h3 id="h3" style="font-family: IBM Plex Sans KR;">메뉴 추가하기</h3>
							<br> <br>
							<form id="menuadd" enctype="multipart/form-data" method="post">
								<table>
									<tr>
										<td><label for="menu_name"
											style="font-family: IBM Plex Sans KR;">메뉴명 </label><br>
											<input class="form-control" type="text" id="menu_name"
											name="menu_name" style="width: 350px;"
											placeholder="메뉴명을 입력하세요.(필수)"></td>
									</tr>
									<tr>
										<td><label for="menu_price"
											style="font-family: IBM Plex Sans KR;">메뉴가격 </label><br>
											<input class="form-control" type="text" id="menu_price"
											name="menu_price" style="width: 350px;"
											placeholder="메뉴가격을 입력하세요.(필수) - 원"></td>
									</tr>
									<tr>
										<td class="contents2"><label for="menu_content"
											style="font-family: IBM Plex Sans KR;">상세 설명</label> <br>
											<textarea placeholder="메뉴에 대해서 설명해주세요." class="form-control"
												rows="3" cols="10" name="menu_content" id="menu_content"></textarea></td>
									</tr>
									<tr>
									<tr>
										<td><label for="fffle"
											style="font-family: IBM Plex Sans KR;">메뉴 사진</label> <span
											style="font-family: IBM Plex Sans KR;">※(필수)</span> <br>
											<div id='image_preview'>
												<button class="btn btn-primary" id="btn2" type="button">사진
													추가</button>
												<input id="btnAtt" multiple="multiple" type="file"
													accept="image/*" name="upload" style="display: none;">
												<span style="font-family: IBM Plex Sans KR;">※첨부파일은
													1개만</span>
												<div id='att_zone'></div>
											</div> <script type="text/javascript">

							( /* att_zone : 이미지들이 들어갈 위치 id, btn : file tag id */
							imageView = function imageView(att_zone, btn){

							var attZone = document.getElementById(att_zone);
							var btnAtt = document.getElementById(btn)
							var sel_files = [];
									    
									    // 이미지와 체크 박스를 감싸고 있는 div 속성
									    var div_style = 'display:inline-block;position:relative;'
									                  + 'width:150px;height:120px;margin:5px;border:1px solid #00f;z-index:1';
									    // 미리보기 이미지 속성
									    var img_style = 'width:100%;height:100%;z-index:none';
									    // 이미지안에 표시되는 체크박스의 속성
									    var chk_style = 'width:30px;height:30px;position:absolute;'
									                  + 'right:0px;bottom:0px;z-index:999;background-color:rgba(255,255,255,0.1);color:#f00';
									  
									    btnAtt.onchange = function(e){
									      var files = e.target.files;
									      var fileArr = Array.prototype.slice.call(files)
									      for(f of fileArr){
									        imageLoader(f);
									      }
									    }  
									    									    
									    /*첨부된 이미리즐을 배열에 넣고 미리보기 */
									    imageLoader = function(file){
									      sel_files.push(file);
									      var reader = new FileReader();
									      reader.onload = function(ee){
									        let img = document.createElement('img')
									        img.setAttribute('style', img_style)
									        img.src = ee.target.result;
									        attZone.appendChild(makeDiv(img, file));
									      }
									      
									      reader.readAsDataURL(file);
									    }
									    
									    /*첨부된 파일이 있는 경우 checkbox와 함께 attZone에 추가할 div를 만들어 반환 */
									    makeDiv = function(img, file){
									      var div = document.createElement('div')
									      div.setAttribute('style', div_style)
									      
									      var btn = document.createElement('input')
									      btn.setAttribute('type', 'button')
									      btn.setAttribute('value', 'x')
									      btn.setAttribute('delFile', file.name);
									      btn.setAttribute('style', chk_style);
									      btn.onclick = function(ev){
									        var ele = ev.srcElement;
									        var delFile = ele.getAttribute('delFile');
									        for(var i=0 ;i<sel_files.length; i++){
									          if(delFile== sel_files[i].name){
									            sel_files.splice(i, 1);      
									          }
									        }
									        
									        dt = new DataTransfer();
									        for(f in sel_files) {
									          var file = sel_files[f];
									          dt.items.add(file);
									        }
									        btnAtt.files = dt.files;
									        var p = ele.parentNode;
									        attZone.removeChild(p)
									      }
									      div.appendChild(img)
									      div.appendChild(btn)
									      return div
									    }
									  }
									)('att_zone', 'btnAtt')

							</script></td>
									</tr>
									<tr>
										<td><label id="suggest" class="form-check-label"
											style="font-family: IBM Plex Sans KR;"> <input
												type="checkbox" class="form-check-input"
												name="menu_suggestion" id="menu_suggestio" value="1">추천메뉴
												선택하기
										</label></td>
									</tr>
									<tr>
									</tr>
								</table>
								<br>
								<div id="output"></div>
								<div id="registerbuttondiv2">
									<input id="modal_close" type="button"
										style="font-family: IBM Plex Sans KR;" class="btn btn-primary"
										value="취소"> <input type="button"
										style="font-family: IBM Plex Sans KR;" class="btn btn-primary"
										id="formButton" onclick="javascript:registformwide()"
										value="등록">
								</div>
								<br>
							</form>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- 검색창 bar와 내용 겹치지 않게 하기 위한 빈 구역 -->
		<div id="empty">
			<p></p>
		</div>
	</div>
</body>
<script type="text/javascript">
	const modal = document.getElementById("modal")
	function modalOn() {
	    modal.style.display = "flex"
	}
	function isModalOn() {
	    return modal.style.display === "flex"
	}
	function modalOff() {
	    modal.style.display = "none"
	}
	const btnModal = document.getElementById("btn-modal")
	btnModal.addEventListener("click", e => {
	    modalOn()
	})
	const closeBtn = document.getElementById("modal_close")
	closeBtn.addEventListener("click", e => {
		$("#menuadd")[0].reset(); 
		$("#att_zone").html(' ');
	    modalOff()
	})
	modal.addEventListener("click", e => {
	    const evTarget = e.target
	    if(evTarget.classList.contains("modal-overlay")) {
	        modalOff()
	    }
	})
	window.addEventListener("keyup", e => {
	    if(isModalOn() && e.key === "Escape") {
	        modalOff()
	    }
	})
	</script>
</html>